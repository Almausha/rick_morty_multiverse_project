{% extends "universe/base.html" %}

{% block title %}Journey Dashboard{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4" style="color: #c9d1d9;">Journey Dashboard</h1>

    <a href="{% url 'create_journey' %}" class="btn btn-success mb-3">Add Journey</a>

    <!-- Search Form -->
    <form method="get" class="d-flex mb-3">
        <input type="text" name="q" class="form-control me-2" placeholder="Search by username" value="{{ request.GET.q }}">
        <button type="submit" class="btn btn-primary">Search</button>
    </form>

    <!-- Most Visited Universe -->
    {% if most_visited %}
        <p style="color:#58a6ff;"><strong>Most visited universe:</strong> {{ most_visited.universe__name }} ({{ most_visited.visits }} visits)</p>
    {% endif %}

    <!-- Recent 3-day counts -->
    {% if recent_counts %}
        <h5 style="color:#c9d1d9;">Travel counts in last 3 days:</h5>
        <ul class="mb-3">
            {% for rc in recent_counts %}
                <li>{{ rc.user__username }}: {{ rc.travel_count }} travels</li>
            {% endfor %}
        </ul>
    {% endif %}

    <!-- Journey Logs Table -->
    <table class="table table-dark table-hover">
        <thead>
            <tr>
                <th>User</th>
                <th>Universe</th>
                <th>Date</th>
                <th>Success</th>
                <th>Manual Entry</th>
                <th>Points</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for log in logs %}
            <tr>
                <td>
                    {% if log.user %}
                        {{ log.user.username }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if log.universe %}
                        {{ log.universe.name }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>{{ log.travel_date|date:"Y-m-d H:i" }}</td>
                <td>
                    {% if log.success %}
                        <span class="text-success fw-bold">Yes</span>
                    {% else %}
                        <span class="text-danger fw-bold">No</span>
                    {% endif %}
                </td>
                <td>
                    <input type="checkbox" disabled {% if log.manual_entry %}checked{% endif %}>
                </td>
                <td>{{ log.points_awarded }}</td>
                <td>
                    <a href="{% url 'edit_journey' log.id %}" class="text-primary me-2">Edit</a>
                    <a href="{% url 'delete_journey' log.id %}" class="text-danger">Delete</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="text-center text-muted">No journey logs found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
